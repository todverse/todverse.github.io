(function(){"use strict";var e={80623:function(e,a,t){var l=t(49963),n=t(66252),i=t(2262),r=t(70473),s=t(3577),o={__name:"ActionButton",props:["tarType","isOn"],setup(e){const a={leads:"Лидах",deals:"Сделках",companies:"Компаниях",contacts:"Контактах",quotes:"Предложениях",invoices:"Умных Счетах",smart:"Смарт-процессах"};return(t,l)=>{const i=(0,n.up)("a-button");return(0,n.wg)(),(0,n.j4)(i,{type:"primary",danger:!e.isOn,onClick:l[0]||(l[0]=e=>t.$emit("clickHandler",e)),tarType:e.tarType},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.isOn?"Включить":"Отключить")+" поля в "+(0,s.zw)(a[e.tarType]),1)])),_:1},8,["danger","tarType"])}}};const c=o;var u=c,E=t(10421);const d=e=>((0,n.dD)("data-v-34cd27fe"),e=e(),(0,n.Cn)(),e),v={id:"init"},p=d((()=>(0,n._)("br",null,null,-1))),I={class:"container_btn"};var A={__name:"Marketplace",setup(e){const a=(0,i.iH)([{isOn:!0,targetType:"leads"},{isOn:!0,targetType:"deals"},{isOn:!0,targetType:"contacts"},{isOn:!0,targetType:"companies"},{isOn:!0,targetType:"smart"},{isOn:!0,targetType:"quotes"},{isOn:!0,targetType:"invoices"}]);(0,n.bv)((async()=>{let e=location.origin+location.pathname,t=await(0,E.OC)("placement.get",{});t.data().forEach((t=>{if(t["handler"]===e){switch(t["placement"]){case"CRM_LEAD_DETAIL_TAB":a.value[0].isOn=!1;break;case"CRM_DEAL_DETAIL_TAB":a.value[1].isOn=!1;break;case"CRM_CONTACT_DETAIL_TAB":a.value[2].isOn=!1;break;case"CRM_COMPANY_DETAIL_TAB":a.value[3].isOn=!1;break;case"CRM_QUOTE_DETAIL_TAB":a.value[5].isOn=!1;break;case"CRM_SMART_INVOICE_DETAIL_TAB":a.value[6].isOn=!1;break}String(t["placement"]).startsWith("CRM_DYNAMIC")&&(a.value[4].isOn=!1)}}))}));const t=(e,a)=>{switch(a){case"leads":return e?"Лиды":"Лидов";case"deals":return e?"Сделки":"Сделок";case"companies":return e?"Компании":"Компаний";case"contacts":return e?"Контакты":"Контактов";case"quotes":return e?"Коммерческих предложениях":"Коммерческих предложений";case"invoices":return e?"Умных Счетах":"Умных Счетов";case"smart":return e?"Смарт Процессы":"Смарт Процессов"}},l=async e=>{const l=a.value.find((a=>a.targetType===e.currentTarget.attributes.tarType.value)),n=a.value.indexOf(l);console.log(n);let i,s=location.origin+location.pathname;if(console.log(s),l)switch(l.targetType){case"leads":i="CRM_LEAD_DETAIL_TAB";break;case"deals":i="CRM_DEAL_DETAIL_TAB";break;case"companies":i="CRM_COMPANY_DETAIL_TAB";break;case"contacts":i="CRM_CONTACT_DETAIL_TAB";break;case"quotes":i="CRM_QUOTE_DETAIL_TAB";break;case"invoices":i="CRM_SMART_INVOICE_DETAIL_TAB";break}if(console.log(i),"smart"===l.targetType){const e=await(0,E.OC)("crm.type.list"),a=e.data().types,t=a.map((e=>e.entityTypeId));l.isOn?t.forEach((async e=>await(0,E.OC)("placement.bind",{PLACEMENT:`CRM_DYNAMIC_${e}_DETAIL_TAB`,HANDLER:s,TITLE:"Приложение поля",DESCRIPTION:"Показать поля"}))):t.forEach((async e=>await(0,E.OC)("placement.unbind",{PLACEMENT:`CRM_DYNAMIC_${e}_DETAIL_TAB`,HANDLER:s})))}else l?.isOn?await(0,E.OC)("placement.bind",{PLACEMENT:i,HANDLER:`${s}`,TITLE:"Приложение поля",DESCRIPTION:"Показать поля"}):await(0,E.OC)("placement.unbind",{PLACEMENT:i,HANDLER:`${s}`});a.value[n].isOn=!a.value[n].isOn,r.Z.open({message:l?.isOn?`'Поля' были убраны из ${t(!l?.isOn,l?.targetType)}`:`'Поля' были добавлены в ${t(!l?.isOn,l?.targetType)}`})};return(e,t)=>{const i=(0,n.up)("a-typography-title"),r=(0,n.up)("a-typography-paragraph");return(0,n.wg)(),(0,n.iD)("div",v,[(0,n.Wm)(i,{level:2,class:"title"},{default:(0,n.w5)((()=>[(0,n.Uk)('Приложение "Показать Поля"')])),_:1}),(0,n.Wm)(r,{class:"title"},{default:(0,n.w5)((()=>[(0,n.Uk)('После нажатия на кнопкну сущности в карточку будет добавлена кнопка "Поля", ')])),_:1}),(0,n.Uk)(),p,(0,n.Wm)(r,{class:"title"},{default:(0,n.w5)((()=>[(0,n.Uk)("с её помощью можно просматривать доступные для карточки поля, их описание дополнительную информацию, а также некоторые данные можно редактировать прямо там")])),_:1}),(0,n._)("div",I,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.value,(e=>((0,n.wg)(),(0,n.j4)(u,{key:e.targetType,targetType:e.targetType,isOn:e.isOn,onClickHandler:l,tarType:e.targetType},null,8,["targetType","isOn","tarType"])))),128))])])}}},m=t(83744);const D=(0,m.Z)(A,[["__scopeId","data-v-34cd27fe"]]);var L=D,g=(t(57658),t(52032)),U=t(63791);async function*T(){const e=[],a={},t=await E.k$.info();let l=t.placement.split("_")[1].toLowerCase(),n=t.options.ID;t.placement.split("_")[2];const i={WORK:"Рабочий",MOBILE:"Мобильный",FAX:"Факс",HOME:"Домашний",PAGER:"Пейджер",MAILING:"Для рассылок",OTHER:"Другой",OPENLINE:"Онлайн-чат",IMOL:"Открытая линия"};class r{constructor(e,a,t,l,n,i,r,s,o,c){this.NAME=e,this.DESCRIPTION=a,this.TYPE=t,this.DISPLAYVALUE=l,this.PERMISSIONS=n,this.EDITOR=i,this.IBLOCKID=r,this.CRMENTITY=s,this.TRUEVALUE=o,this.ENUM=c}}let s,o;if("dynamic"===l){const e=t.placement.split("_")[2],a=t.options.ID;s=await(await(0,E.OC)("crm.item.get",{id:a,entityTypeId:e})).data(),o=await(await(0,E.OC)("crm.item.fields",{entityTypeId:e})).data().fields,console.log(o)}else if("smart"===l){const e=31,a=t.options.ID;s=await(await(0,E.OC)("crm.item.get",{id:a,entityTypeId:e})).data(),o=await(await(0,E.OC)("crm.item.fields",{entityTypeId:e})).data().fields,console.log(o)}else s=await(await(0,E.OC)(`crm.${l}.get`,{id:n})).data(),o=await(await(0,E.OC)(`crm.${l}.fields`,{})).data();return Object.keys(o).forEach((a=>{let t=[],l="",n=[],i=0,s="",c="";s=o[a].formLabel?o[a].formLabel:o[a].title,o[a].isDynamic&&t.push("Динамичный"),o[a].isImmutable&&t.push("Неизменный"),o[a].isMultiple&&t.push("Множественный"),o[a].isReadOnly&&t.push("Только для чтения"),o[a].isRequired&&t.push("Обязательное"),o[a].isMultiple&&"crm_multifield"===o[a].type&&(l="multiedit"),o[a].isMultiple&&"crm_multifield"!==o[a].type||o[a].items&&o[a].isMultiple?l="string"===o[a].type||"integer"===o[a].type||"double"===o[a].type||"url"===o[a].type?"textArray":"checkBoxes":o[a].items&&!o[a].isMultiple&&(l="selectBox"),"enumeration"===o[a].type&&"checkBoxes"===l?(console.log(o[a]),o[a].items.forEach((e=>{n.push(e)}))):"enumeration"===o[a].type&&"selectBox"===l&&o[a].items.forEach((e=>{n.push(e)})),o[a].type.startsWith("iblock_")&&(i=o[a].settings.IBLOCK_ID),"crm"===o[a].type&&(c=Object.keys(o[a].settings).filter((e=>"Y"===o[a].settings[e]))),"string"!==o[a].type&&"integer"!==o[a].type&&"double"!==o[a].type&&"url"!==o[a].type||o[a].isMultiple||(l="textBox"),"file"===o[a].type&&console.log(o[a]),"user"!==o[a].type&&"employee"!==o[a].type&&"crm_company"!==o[a].type&&"iblock_element"!==o[a].type&&"iblock_section"!==o[a].type&&"crm_status"!==o[a].type&&"crm_currency"!==o[a].type&&"crm_contact"!==o[a].type&&"char"!==o[a].type||o[a].isMultiple||(l="selectBox"),"crm_quote"!==o[a].type&&"money"!==o[a].type&&"resourcebooking"!==o[a].type&&"file"!==o[a].type&&"location"!==o[a].type&&"crm_category"!==o[a].type||(l="nan"),e.push(new r(a,s,o[a].type,"",t,l,i,c,"",n))})),e.forEach((e=>{const t=e.NAME,l=s[e.NAME];if("crm_multifield"===e.TYPE&&(e.ALLOW=!0,e.TRUEVALUE=l,l&&l.length&&l.forEach((a=>{i[a.VALUE_TYPE]?e.DISPLAYVALUE+=`${i[a.VALUE_TYPE]}: ${a.VALUE},`:e.DISPLAYVALUE+=`${a.VALUE_TYPE}: ${a.VALUE}, `}))),"checkBoxes"===e.EDITOR&&(e.ALLOW=!0,console.log(l),l&&(e.TRUEVALUE=e.ENUM.filter((e=>l.includes(Number(e.ID))))),e.TRUEVALUE&&(e.DISPLAYVALUE=e.TRUEVALUE.map((e=>e.VALUE)).join(", "))),"textBox"===e.EDITOR&&(e.ALLOW=!0,e.TRUEVALUE=l,e.DISPLAYVALUE=l),"textArray"===e.EDITOR&&(e.ALLOW=!0,console.log(l),e.TRUEVALUE=l,l&&(e.DISPLAYVALUE=l.join(", "))),"selectBox"===e.EDITOR&&"enumeration"===e.TYPE){if(e.ALLOW=!0,!l)return;e.DISPLAYVALUE=e.ENUM.filter((e=>e.ID==l))[0].VALUE,e.TRUEVALUE=e.ENUM.filter((e=>e.ID==l))[0]}if("char"===e.TYPE&&(e.ALLOW=!0,e.DISPLAYVALUE=l,e.TRUEVALUE={ID:l,NAME:l}),"boolean"===e.TYPE&&(e.ALLOW=!0,e.EDITOR="selectBox",1==l?(e.TRUEVALUE={ID:1,NAME:"Да"},e.DISPLAYVALUE="Да"):0==l&&(e.TRUEVALUE={ID:0,NAME:"Нет"},e.DISPLAYVALUE="Нет")),"crm"===e.TYPE&&(e.DISPLAYVALUE=l,e.PERMISSIONS.includes("Множественный")?e.EDITOR="crmMulti":e.EDITOR="crm",a[t]={type:e.TYPE,entity:e.CRMENTITY,value:l}),"user"!==e.TYPE&&"employee"!==e.TYPE&&"crm_company"!==e.TYPE&&"crm_status"!==e.TYPE&&"crm_currency"!==e.TYPE&&"crm_contact"!==e.TYPE||(e.DISPLAYVALUE=l,a[t]={type:e.TYPE,value:l}),"crm_currency"===e.TYPE&&(e.ALLOW=!0),"iblock_element"!==e.TYPE&&"iblock_section"!==e.TYPE||(e.DISPLAYVALUE=l,a[t]={type:e.TYPE,value:l,iblockid:e.IBLOCKID}),"datetime"===e.TYPE){if(e.ALLOW=!0,e.EDITOR="datetime",!l)return;e.DISPLAYVALUE=new Date(l).toLocaleString("RU"),e.TRUEVALUE=l}if("date"===e.TYPE){if(e.ALLOW=!0,e.EDITOR="date",!l)return;e.DISPLAYVALUE=new Date(l).toLocaleDateString("RU"),e.TRUEVALUE=l}})),[e,a]}async function*y(e,a){const t=[],l=[],n=[],i=[],r=[],s=[],o=[],c=[],u=[],d=[],v=[],p=[],I=[],A=[],m=[],D=[];Object.keys(a.value).forEach((async e=>{switch(a.value[e].type){case"employee":case"user":t.push(a.value[e].value),l.push({name:e,id:a.value[e].value});break;case"crm_company":n.push(a.value[e].value),i.push({name:e,id:a.value[e].value});break;case"iblock_element":r.push(a.value[e].value),o.push(a.value[e].iblockid),s.push({name:e,id:a.value[e].value,IBLOCK_ID:a.value[e].iblockid});break;case"crm_status":v.push(a.value[e].value),p.push({name:e,id:a.value[e].value});break;case"crm":console.log(a.value[e]),I.push({id:a.value[e].value,entity:a.value[e].entity}),A.push({name:e,id:a.value[e].value,entity:a.value[e].entity});break;case"crm_contact":m.push(a.value[e].value),D.push({name:e,id:a.value[e].value});break}}));const L=Array.from(new Set(t)).flat();if(L.length){const a=(await(0,E.OC)("user.get",{id:L})).data(),t=a,n=e=>""!==e.NAME?`${e.NAME} ${e.LAST_NAME||""}, `:`${e.EMAIL}, `;l.forEach((a=>{const l=e.value.filter((e=>e.NAME===a.name))[0];if(Array.isArray(a.id)&&a.id.length)l.DISPLAYVALUE=t.filter((e=>a.id.includes(Number(e.ID)))).map((e=>n(e))).reduce(((e,a)=>e.concat(a))),l.TRUEVALUE=t.filter((e=>a.id.includes(Number(e.ID))));else if(a.id&&0!=a.id){const l=e.value.filter((e=>e.NAME===a.name))[0];l.DISPLAYVALUE=n(t.filter((e=>e.ID===a.id))[0]),l.TRUEVALUE=t.filter((e=>e.ID===a.id))[0]}l.ALLOW=!0}))}const g=Array.from(new Set(n)).flat();if(g.length){const a=(await(0,E.OC)("crm.company.list",{id:g})).data(),t=a;i.forEach((a=>{const l=e.value.filter((e=>e.NAME===a.name))[0];if(Array.isArray(a.id)&&a.id.length)l.DISPLAYVALUE=t.filter((e=>a.id.includes(Number(e.ID)))).reduce(((e,a)=>e.TITLE+", "+a.TITLE)),l.TRUEVALUE=t.filter((e=>a.id.includes(Number(e.ID))));else{const l=e.value.filter((e=>e.NAME===a.name))[0];l.TRUEVALUE=t.filter((e=>e.ID===a.id))[0],l.TRUEVALUE&&(l.DISPLAYVALUE=t.filter((e=>e.ID===a.id))[0].TITLE)}l.ALLOW=!0}))}const U=Array.from(new Set(m)).flat();if(U.length){const a=(await(0,E.OC)("crm.contact.list",{id:U})).data(),t=a;D.forEach((a=>{const l=e.value.filter((e=>e.NAME===a.name))[0];if(Array.isArray(a.id)&&a.id.length)l.DISPLAYVALUE=t.filter((e=>a.id.includes(Number(e.ID)))).reduce(((e,a)=>e.NAME+", "+a.NAME)),l.TRUEVALUE=t.filter((e=>a.id.includes(Number(e.ID))));else{const l=e.value.filter((e=>e.NAME===a.name))[0];l.TRUEVALUE=t.filter((e=>e.ID===a.id))[0],l.TRUEVALUE&&(l.DISPLAYVALUE=t.filter((e=>e.ID===a.id))[0].NAME)}l.ALLOW=!0}))}const T=Array.from(new Set(r)).flat(),y=Array.from(new Set(o)).flat();if(T.length){const a=y.map((e=>({[e]:{method:"lists.get.iblock.type.id",params:{IBLOCK_ID:e}}}))),t=[];let l;while(a.length){const e=a.splice(0,50);l={};for(let a=0;a<e.length;a++)l[Object.keys(e[a])[0]]=Object.values(e[a])[0];const n=await(0,E.iy)(l);t.push(n)}const n=[];t.forEach((e=>{const a=s.filter((a=>Object.keys(e).includes(a.IBLOCK_ID.toString()))).map((a=>({...a,IBLOCK_TYPE_ID:e[a.IBLOCK_ID].answer.result})));n.push(a.filter((e=>0!=e.id)).map((e=>Array.isArray(e.id)?e.id.map((a=>({[a]:{method:"lists.element.get",params:{IBLOCK_ID:e.IBLOCK_ID,IBLOCK_TYPE_ID:e.IBLOCK_TYPE_ID,ELEMENT_ID:a}}}))):{[e.id]:{method:"lists.element.get",params:{IBLOCK_ID:e.IBLOCK_ID,IBLOCK_TYPE_ID:e.IBLOCK_TYPE_ID,ELEMENT_ID:e.id}}})))}));const i=[];n.forEach((e=>{e.forEach((e=>{Array.isArray(e)?e.forEach((e=>{i.push(e)})):i.push(e)}))}));const r=[];while(i.length){const e=i.splice(0,50);l={};for(let t=0;t<e.length;t++)l[Object.keys(e[t])[0]]=Object.values(e[t])[0];const a=await(0,E.iy)(l);r.push(a)}const o={};r.forEach((e=>{Object.keys(e).forEach((a=>{o[a]=e[a]}))})),s.forEach((a=>{const t=e.value.filter((e=>e.NAME===a.name))[0];if(Array.isArray(a.id)&&a.id.length)t.TRUEVALUE=t.DISPLAYVALUE.map((e=>({ID:e,NAME:o[e].answer.result[0].NAME}))).map((e=>({ID:`${e.ID}`,NAME:`${e.NAME} [${e.ID}]`}))),t.DISPLAYVALUE=t.DISPLAYVALUE.map((e=>({ID:e,NAME:o[e].answer.result.length&&o[e].answer.result[0].NAME}))).map((e=>`${e.NAME} [${e.ID}], `)).reduce(((e,a)=>e.concat(a)));else{const t=e.value.filter((e=>e.NAME===a.name))[0];if(t.DISPLAYVALUE&&o[t.DISPLAYVALUE]){const e=o[t.DISPLAYVALUE].answer.result[0].ID,a=o[t.DISPLAYVALUE].answer.result[0].NAME;t.TRUEVALUE=o[t.DISPLAYVALUE].answer.result[0],t.DISPLAYVALUE=`${a} [${e}]`,t.ALLOW=!0}}t.ALLOW=!0}))}const f=Array.from(new Set(c)).flat(),h=Array.from(new Set(d)).flat();if(f.length){const a=h.map((e=>({[e]:{method:"lists.get.iblock.type.id",params:{IBLOCK_ID:e}}}))),t=[];let l;while(a.length){const e=a.splice(0,50);l={};for(let a=0;a<e.length;a++)l[Object.keys(e[a])[0]]=Object.values(e[a])[0];const n=await(0,E.iy)(l);t.push(n)}const n=[];t.forEach((e=>{const a=u.filter((a=>Object.keys(e).includes(a.IBLOCK_ID.toString()))).map((a=>({...a,IBLOCK_TYPE_ID:e[a.IBLOCK_ID].answer.result})));n.push(a.filter((e=>0!=e.id)).map((e=>Array.isArray(e.id)?e.id.map((a=>({[a]:{method:"lists.section.get",params:{IBLOCK_ID:e.IBLOCK_ID,IBLOCK_TYPE_ID:e.IBLOCK_TYPE_ID,FILTER:{id:e.id}}}}))):{[e.id]:{method:"lists.section.get",params:{IBLOCK_ID:e.IBLOCK_ID,IBLOCK_TYPE_ID:e.IBLOCK_TYPE_ID,FILTER:{id:e.id}}}})))}));const i=[];n.forEach((e=>{e.forEach((e=>{Array.isArray(e)?e.forEach((e=>{i.push(e)})):i.push(e)}))}));const r=[];while(i.length){const e=i.splice(0,50);l={};for(let t=0;t<e.length;t++)l[Object.keys(e[t])[0]]=Object.values(e[t])[0];const a=await(0,E.iy)(l);r.push(a)}const s={};r.forEach((e=>{Object.keys(e).forEach((a=>{s[a]=e[a]}))})),u.forEach((a=>{const t=e.value.filter((e=>e.NAME===a.name))[0];if(Array.isArray(a.id))t.TRUEVALUE=t.DISPLAYVALUE,t.DISPLAYVALUE=t.DISPLAYVALUE.map((e=>({ID:e,NAME:s[e].answer.result[0].NAME}))).map((e=>`${e.NAME} [${e.ID}], `)).reduce(((e,a)=>e.concat(a)));else if(t.DISPLAYVALUE){const e=s[t.DISPLAYVALUE].answer.result[0].ID,a=s[t.DISPLAYVALUE].answer.result[0].NAME;t.DISPLAYVALUE=`${a} [${e}]`,t.TRUEVALUE=s[t.DISPLAYVALUE].answer.result[0]}t.ALLOW=!0}))}if(p.length){const a=(await(0,E.OC)("crm.status.list",{STATUS_ID:v})).data(),t=a.map((e=>({ID:e.STATUS_ID,NAME:e.NAME}))).concat({ID:"undefined",NAME:"Не выбран"});p.forEach((a=>{const l=e.value.filter((e=>e.NAME===a.name))[0];console.log(l),l.TRUEVALUE=t.filter((e=>e.ID===a.id))[0],l.TRUEVALUE&&(l.DISPLAYVALUE=t.filter((e=>e.ID===a.id))[0].NAME),l.ALLOW=!0}))}const w=Array.from(new Set(I));if(w.length){let a;console.log(Array.from(new Set(w.filter((e=>e.entity.includes("DEAL")))))),a=Array.from(new Set(w.filter((e=>e.entity.includes("DEAL")))));const t=a.map((e=>Array.isArray(e.id)?e.id.length?e.id.filter((e=>e.startsWith("D_"))).map((e=>String(e).substring(2))):[]:e.id.startsWith("D_")&&String(e.id).substring(2))).flat();a=Array.from(new Set(w.filter((e=>e.entity.includes("LEAD")))));const l=a.map((e=>Array.isArray(e.id)?e.id.length?e.id.filter((e=>e.startsWith("L_"))).map((e=>String(e).substring(2))):[]:e.id.startsWith("L_")&&String(e.id).substring(2))).flat();a=Array.from(new Set(w.filter((e=>e.entity.includes("COMPANY")))));const n=a.map((e=>Array.isArray(e.id)?e.id.length?e.id.filter((e=>e.startsWith("CO"))).map((e=>String(e).substring(3))):[]:e.id.startsWith("CO")&&String(e.id).substring(3))).flat();a=Array.from(new Set(w.filter((e=>e.entity.includes("CONTACT")))));const i=a.map((e=>Array.isArray(e.id)?e.id.length?e.id.filter((e=>e.startsWith("C_"))).map((e=>String(e).substring(2))):[]:e.id.startsWith("C_")&&String(e.id).substring(2))).flat();a=Array.from(new Set(w.filter((e=>e.entity.includes("SMART_INVOICE")))));const r=a.map((e=>Array.isArray(e.id)?e.id.length?e.id.filter((e=>e.startsWith("SI_"))).map((e=>String(e).substring(3))):[]:e.id.startsWith("SI_")&&String(e.id).substring(3))).flat(),s={};if(t.length){const a=await(await(0,E.OC)("crm.deal.list",{filter:{"=ID":t},select:["ID","TITLE"]})).data();s["DEAL"]=a,A.filter((e=>e.entity.includes("DEAL"))).forEach((t=>{const l=e.value.filter((e=>e.NAME===t.name))[0];if(Array.isArray(l.DISPLAYVALUE)){const e=l.DISPLAYVALUE.filter((e=>e.startsWith("D_"))).map((e=>String(e).substring(2)));a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...l.TRUEVALUE,...a.filter((a=>e.includes(a.ID))).map((e=>`D_${e.ID}`))])}else if(l.DISPLAYVALUE.startsWith("D_")){const e=l.DISPLAYVALUE.substring(2);a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...a.filter((a=>e.includes(a.ID))).map((e=>`D_${e.ID}`))])}}))}if(l.length){console.log(l);const a=await(await(0,E.OC)("crm.lead.list",{filter:{"=ID":l},select:["ID","NAME","TITLE"]})).data();s["LEAD"]=a,A.filter((e=>e.entity.includes("LEAD"))).forEach((t=>{const l=e.value.filter((e=>e.NAME===t.name))[0];if(Array.isArray(l.DISPLAYVALUE)){const e=l.DISPLAYVALUE.filter((e=>e.startsWith("L_"))).map((e=>String(e).substring(2)));a.filter((a=>e.includes(a.ID))).length&&(console.log(a.filter((a=>e.includes(a.ID)))),l.TRUEVALUE=[...l.TRUEVALUE,...a.filter((a=>e.includes(a.ID))).map((e=>`L_${e.ID}`))])}else if(l.DISPLAYVALUE.startsWith("L_")){const e=l.DISPLAYVALUE.substring(2);a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...a.filter((a=>e.includes(a.ID))).map((e=>`L_${e.ID}`))])}}))}if(n.length){const a=await(await(0,E.OC)("crm.company.list",{filter:{"=ID":n},select:["ID","TITLE"]})).data();s["COMPANY"]=a,A.filter((e=>e.entity.includes("COMPANY"))).forEach((t=>{const l=e.value.filter((e=>e.NAME===t.name))[0];if(Array.isArray(l.DISPLAYVALUE)){const e=l.DISPLAYVALUE.filter((e=>e.startsWith("CO_"))).map((e=>String(e).substring(3)));a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...l.TRUEVALUE,...a.filter((a=>e.includes(a.ID))).map((e=>`CO_${e.ID}`))])}else if(l.DISPLAYVALUE.startsWith("CO_")){const e=l.DISPLAYVALUE.substring(3);a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...a.filter((a=>e.includes(a.ID))).map((e=>`CO_${e.ID}`))])}}))}if(i.length){const a=await(await(0,E.OC)("crm.contact.list",{filter:{"=ID":i},select:["ID","TITLE","NAME"]})).data();s["CONTACT"]=a,A.filter((e=>e.entity.includes("CONTACT"))).forEach((t=>{const l=e.value.filter((e=>e.NAME===t.name))[0];if(Array.isArray(l.DISPLAYVALUE)){const e=l.DISPLAYVALUE.filter((e=>e.startsWith("C_"))).map((e=>String(e).substring(2)));a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...l.TRUEVALUE,...a.filter((a=>e.includes(a.ID))).map((e=>`C_${e.ID}`))])}else if(l.DISPLAYVALUE.startsWith("C_")){const e=l.DISPLAYVALUE.substring(2);a.filter((a=>e.includes(a.ID))).length&&(l.TRUEVALUE=[...a.filter((a=>e.includes(a.ID))).map((e=>`C_${e.ID}`))])}}))}if(r.length){const a=await(await(0,E.OC)("crm.item.list",{entityTypeId:7,filter:{"=id":r},select:["ID","searchContent"]})).data().items;s["INVOICE"]=a,A.filter((e=>e.entity.includes("SMART_INVOICE"))).forEach((t=>{const l=e.value.filter((e=>e.NAME===t.name))[0];if(Array.isArray(l.DISPLAYVALUE)){const e=l.DISPLAYVALUE.filter((e=>e.startsWith("SI_"))).map((e=>String(e).substring(3)));console.log(a,e),a.filter((a=>e.includes(String(a.id)))).length&&(l.TRUEVALUE=[...l.TRUEVALUE,...a.filter((a=>e.includes(String(a.id)))).map((e=>`SI_${e.id}`))])}else if(l.DISPLAYVALUE.startsWith("SI_")){const e=l.DISPLAYVALUE.substring(3);console.log(a.filter((a=>e.includes(a.ID)))),a.filter((a=>e.includes(a.id))).length&&(l.TRUEVALUE=[...a.filter((a=>e.includes(a.id))).map((e=>`SI_${e.id}`))])}}))}A.forEach((a=>{const t=e.value.filter((e=>e.NAME===a.name))[0];t.TRUEVALUE.length&&(t.DISPLAYVALUE=t.TRUEVALUE.map((e=>{switch(e.substring(0,2)){case"L_":{const a=e.substring(2),t=s["LEAD"].filter((e=>e.ID==a))[0].TITLE;return`Лид: ${t} [${a}], `}case"D_":{const a=e.substring(2),t=s["DEAL"].filter((e=>e.ID==a))[0].TITLE;return`Сделка: ${t} [${a}], `}case"C_":{const a=e.substring(2),t=s["CONTACT"].filter((e=>e.ID==a))[0].NAME;return`Контакт: ${t} [${a}], `}case"SI":{const a=e.substring(3);console.log(s["INVOICE"]);const t=s["INVOICE"].filter((e=>e.id==a))[0].searchContent;return`Счет: ${t} [${a}], `}case"CO":{const a=e.substring(3),t=s["COMPANY"].filter((e=>e.ID==a))[0].TITLE;return`Компания: ${t} [${a}], `}}})).join("")),t.ALLOW=!0}))}}const f=[{dataField:"COUNTUSES",caption:"Подсчитать количество использований",name:"COUNTUSES",allowEditing:!1,allowHeaderFiltering:!0,columnAutoWidth:!0,columnResizingMode:"COUNTUSES",width:"auto"},{dataField:"NAME",caption:"Название",name:"NAME",allowEditing:!1,allowHeaderFiltering:!0},{dataField:"DESCRIPTION",name:"DESCRIPTION",caption:"Описание",allowEditing:!1},{dataField:"DISPLAYVALUE",name:"DISPLAYVALUE",caption:"Значение",allowEditing:!0,cellTemplate:"grid-cell"},{dataField:"PERMISSIONS",name:"PERMISSIONS",caption:"Разрешения",allowEditing:!1},{dataField:"TYPE",name:"TYPE",caption:"Тип",allowEditing:!1}];var h=f,w=t(74372),C=t.n(w),O=t(84795),b=t.n(O),V=t(96486),N=t.n(V);const M=(0,n._)("br",null,null,-1);var R={__name:"Enum",props:["row","valueRef"],emits:["changePending"],setup(e,{emit:a}){const t=e,l=(0,i.iH)({}),r=(0,i.iH)([]),s=(0,i.iH)([]),o=(0,i.iH)(null),c=(0,i.iH)([]),u=(0,i.iH)(!1);(0,n.bv)((async()=>{switch(l.value=t.row,l.value.TYPE){case"enumeration":r.value=l.value.ENUM.map((e=>({ID:e.ID,NAME:e.VALUE}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})),Array.isArray(l.value.TRUEVALUE)?s.value=N().cloneDeep(l.value.TRUEVALUE):s.value=[],c.value=N().cloneDeep(r.value);break;case"iblock_section":{const e=l.value.IBLOCKID,a=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:e})).data(),t={IBLOCK_ID:e,IBLOCK_TYPE_ID:a};r.value=await(await(0,E.OC)("lists.section.get",t)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})),Array.isArray(l.value.TRUEVALUE)?s.value=N().cloneDeep(l.value.TRUEVALUE):s.value=[],c.value=N().cloneDeep(r.value);break}case"crm_company":r.value=await(await(0,E.OC)("crm.company.list")).data().map((e=>({ID:e.ID,NAME:e.TITLE}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})),Array.isArray(l.value.TRUEVALUE)?s.value=N().cloneDeep(l.value.TRUEVALUE):s.value=[];break;case"crm_contact":r.value=await(await(0,E.OC)("crm.contact.list")).data().map((e=>({ID:e.ID,NAME:e.NAME}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})),Array.isArray(l.value.TRUEVALUE)?s.value=N().cloneDeep(l.value.TRUEVALUE):s.value=[];break;case"iblock_element":{const e=l.value.IBLOCKID,a=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:e})).data(),t={IBLOCK_ID:e,IBLOCK_TYPE_ID:a};r.value=await(await(0,E.OC)("lists.element.get",t)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})),Array.isArray(l.value.TRUEVALUE)?s.value=N().cloneDeep(l.value.TRUEVALUE):s.value=[],console.log(r.value),c.value=N().cloneDeep(r.value),c.value.length<50&&(u.value=!0);break}case"user":case"employee":{const e={FILTER:{USER_TYPE:l.value.TYPE}};r.value=await(await(0,E.OC)("user.get",e)).data().map((e=>({ID:e.ID,NAME:""!==e.NAME?`${e.NAME} ${e.LAST_NAME}`:e.EMAIL}))).map((e=>l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})),console.log(r.value),c.value=N().cloneDeep(r.value),Array.isArray(l.value.TRUEVALUE)?s.value=N().cloneDeep(l.value.TRUEVALUE):s.value=[],c.value.length<50&&(u.value=!0)}}}));const d=e=>{console.log(e);const t=e.itemData;if(console.log("imchangiiiin",t),e.itemData.CHECK)console.log(s),s.value.push(t);else{const e=s.value.find((e=>e.ID==t.ID)),a=s.value.indexOf(e);s.value.splice(a,1)}let l;console.log(s.value),s.value.length?(l=r.value.filter((e=>s.value.filter((a=>a.ID==e.ID)).length)).map((e=>`${e.NAME}, `)).reduce(((e,a)=>e.concat(a))),console.log(l,"gay")):l="";let n=N().cloneDeep(s.value);a("changePending",N().cloneDeep(n),l)},v=()=>{console.log("hey sexy"),document.getElementsByClassName("dx-texteditor-input")[1].addEventListener("input",p),document.getElementsByClassName("dx-icon-clear")[0].addEventListener("click",(()=>{r.value=N().cloneDeep(c.value)}))},p=async e=>{if(!u)switch(l.value.TYPE){case"crm_company":r.value=await(await(0,E.OC)("crm.company.list",{FILTER:{"%TITLE":e.target.value}})).data().map((e=>({ID:e.ID,NAME:e.TITLE}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e}));break;case"iblock_section":{const a=l.value.IBLOCKID,t=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:a})).data(),n={IBLOCK_ID:a,IBLOCK_TYPE_ID:t,FILTER:{"%NAME":e.target.value}};r.value=await(await(0,E.OC)("lists.section.get",n)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a==e.ID)).length?{...e,CHECK:!0}:{...e})).forEach((e=>{console.log(r.value.includes((a=>a.ID==e.ID))),r.value.filter((a=>a.ID==e.ID)).length||r.value.push(e)})),l.value.TRUEVALUE&&(s.value=N().cloneDeep(l.value.TRUEVALUE.ID)),c.value=N().cloneDeep(r.value);break}case"crm_contact":await(await(0,E.OC)("crm.contact.list",{FILTER:{"%NAME":e.target.value}})).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>l.value.TRUEVALUE&&l.value.TRUEVALUE.length&&l.value.TRUEVALUE.filter((a=>a==e.ID)).length?{...e,CHECK:!0}:{...e})).forEach((e=>{console.log(r.value.includes((a=>a.ID==e.ID))),r.value.filter((a=>a.ID==e.ID)).length||r.value.push(e)}));break;case"iblock_element":{const a=l.value.IBLOCKID,t=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:a})).data(),n={IBLOCK_ID:a,IBLOCK_TYPE_ID:t,FILTER:{SEARCHABLE_CONTENT:`%${e.target.value}%`}};await(await(0,E.OC)("lists.element.get",n)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>l.value.TRUEVALUE.filter((a=>a==e.ID)).length?{...e,CHECK:!0}:{...e})).forEach((e=>{console.log(r.value.includes((a=>a.ID==e.ID))),r.value.filter((a=>a.ID==e.ID)).length||r.value.push(e)}));break}case"user":case"employee":await(await(0,E.OC)("user.search",{FIND:`${e.target.value}`})).data().map((e=>({ID:user.ID,NAME:""!==user.NAME?`${user.NAME} ${user.LAST_NAME}`:user.EMAIL}))).map((e=>l.value.TRUEVALUE.filter((a=>a==e.ID)).length?{...e,CHECK:!0}:{...e})).forEach((e=>{console.log(r.value.includes((a=>a.ID==e.ID))),r.value.filter((a=>a.ID==e.ID)).length||r.value.push(e)}));break}},I=()=>{a("changePending","","")};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(t,{onClick:I},{default:(0,n.w5)((()=>[(0,n.Uk)("Очистить значение поля")])),_:1}),M,(0,n.Wm)((0,i.SU)(C()),{value:s.value,"data-source":r.value,"value-expr":"ID","display-expr":"NAME",onOpened:v},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{onOpened:v,"selected-expr":"CHECK",ref_key:"drop",ref:o,value:s.value,"data-structure":"plain","selection-mode":"multiple","show-check-boxes-mode":"normal",onItemSelectionChanged:d,opened:!0,"search-enabled":!0,"key-expr":"ID","display-expr":"NAME","data-source":r.value},null,8,["value","data-source"])])),_:1},8,["value","data-source"])],64)}}};const S=R;var k=S;const P=(0,n._)("br",null,null,-1);var Y={__name:"Select",props:["row","valueRef"],emits:["changePending"],setup(e,{emit:a}){const t=e,l=(0,i.iH)([]),r=(0,i.iH)({}),s=(0,i.iH)([]),o=(0,i.iH)({}),c=(0,i.iH)(!1),u=(0,i.iH)(0),d=async e=>{switch(console.log(e),r.value.TYPE){case"iblock_section":{const a=r.value.IBLOCKID,t=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:a})).data(),n={IBLOCK_ID:a,IBLOCK_TYPE_ID:t,FILTER:{"%NAME":e.event.currentTarget.value}};s.value=await(await(0,E.OC)("lists.section.get",n)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID)),l.value=N().cloneDeep(s.value);break}case"crm_contact":s.value=await(await(0,E.OC)("crm.contact.list",{FILTER:{"%TITLE":e.event.currentTarget.value}})).data().map((e=>({ID:e.ID,NAME:e.NAME}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),l.value=N().cloneDeep(s.value),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE).ID);break;case"crm_company":s.value=await(await(0,E.OC)("crm.company.list",{FILTER:{"%TITLE":e.event.currentTarget.value}})).data().map((e=>({ID:e.ID,NAME:e.TITLE}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE).ID),l.value=N().cloneDeep(s.value);break;case"iblock_element":{const a=r.value.IBLOCKID,t=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:a})).data(),l={IBLOCK_ID:a,IBLOCK_TYPE_ID:t,FILTER:{SEARCHABLE_CONTENT:`%${e.event.currentTarget.value}%`}};s.value=await(await(0,E.OC)("lists.element.get",l)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e}));break}case"user":case"employee":s.value=await(await(0,E.OC)("user.search",{FIND:`${e.event.currentTarget.value}`})).data().map((e=>({ID:e.ID,NAME:""!==e.NAME?`${e.NAME} ${e.LAST_NAME}`:e.EMAIL}))).map((e=>r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e}));break}},v=()=>{document.getElementsByClassName("dx-texteditor-input")[0].addEventListener("input",d)},p=e=>{console.log(e),console.log(s.value);const t=s.value.find((a=>a.ID==e.itemData.ID));console.log(t),console.log(t.NAME);const l=t.NAME;a("changePending",t,l),c.value=!1},I=(e,a)=>{u.value=e?.component?.getSelectedNodeKeys()||a,console.log(u),c.value=!1};(0,n.bv)((async()=>{switch(r.value=N().cloneDeep(t.row),r.value.TYPE){case"char":s.value=[{ID:"Y",NAME:"Y"},{ID:"N",NAME:"N"}];break;case"crm_contact":s.value=await(await(0,E.OC)("crm.contact.list")).data().map((e=>({ID:e.ID,NAME:e.NAME}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),l.value=N().cloneDeep(s.value),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE).ID);break;case"crm_currency":s.value=await(await(0,E.OC)("crm.currency.list")).data().map((e=>({ID:e.CURRENCY,NAME:e.CURRENCY}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),l.value=N().cloneDeep(s.value),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE).ID);break;case"crm_company":s.value=await(await(0,E.OC)("crm.company.list")).data().map((e=>({ID:e.ID,NAME:e.TITLE}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE).ID),l.value=N().cloneDeep(s.value);break;case"iblock_section":{const e=r.value.IBLOCKID,a=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:e})).data(),t={IBLOCK_ID:e,IBLOCK_TYPE_ID:a};s.value=await(await(0,E.OC)("lists.section.get",t)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>r.value.TRUEVALUE&&r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID)),l.value=N().cloneDeep(s.value);break}case"crm_status":{let e=await(await(0,E.OC)("crm.status.list")).data().map((e=>({ID:e.STATUS_ID,NAME:e.NAME})));r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID)),console.log(r.value.TRUEVALUE);let a=Array.from(new Set(e.map((e=>e.ID))));a.forEach((a=>{s.value=[...s.value,e.find((e=>e.ID==a))]})),console.log(e.map((e=>e.ID)).length),console.log(Array.from(new Set(e.map((e=>e.ID)))).length),I(null,r.value.TRUEVALUE.ID);break}case"boolean":s.value=[{ID:0,NAME:"Нет"},{ID:1,NAME:"Да"}],r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID));break;case"iblock_element":{const e=r.value.IBLOCKID,a=await(await(0,E.OC)("lists.get.iblock.type.id",{IBLOCK_ID:e})).data(),t={IBLOCK_ID:e,IBLOCK_TYPE_ID:a};s.value=await(await(0,E.OC)("lists.element.get",t)).data().map((e=>({ID:e.ID,NAME:`${e.NAME} [${e.ID}]`}))).map((e=>r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID)),l.value=N().cloneDeep(s.value);break}case"user":case"employee":{const e=r.value.TRUEVALUE.ID,a=await(await(0,E.OC)("user.get",{ID:e})).data(),t=await(await(0,E.OC)("user.get")).data(),n=[...a,...t],i=Array.from(new Set([...a.map((e=>e.ID)),...t.map((e=>e.ID))])),c=[];i.forEach((e=>{c.push(n.find((a=>a.ID==e)))})),s.value=c.map((e=>({ID:e.ID,NAME:""!==e.NAME?`${e.NAME} ${e.LAST_NAME}`:e.EMAIL}))).map((e=>r.value.TRUEVALUE.ID==e.ID?{...e,CHECK:!0}:{...e})),l.value=N().cloneDeep(s.value),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID),I(null,r.value.TRUEVALUE.ID));break}case"enumeration":s.value=N().cloneDeep(r.value.ENUM.map((e=>({ID:e.ID,NAME:e.VALUE})))),console.log(r.value),r.value.TRUEVALUE&&(o.value=N().cloneDeep(r.value.TRUEVALUE.ID));break}}));const A=()=>{a("changePending","",""),u.value=null};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(t,{onClick:A},{default:(0,n.w5)((()=>[(0,n.Uk)("Очистить значение поля")])),_:1}),P,(0,n.Wm)((0,i.SU)(C()),{value:u.value,onOpened:v,opened:c.value,"value-expr":"ID","display-expr":"NAME","data-source":s.value},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{"data-source":s.value,"select-by-click":!0,"search-enabled":!0,"selection-mode":"single",opened:c.value,"key-expr":"ID",onItemSelectionChanged:a[0]||(a[0]=e=>I(e)),"display-expr":"NAME","search-expr":"NAME","search-editor-options":{onInput:(0,i.SU)(N()).debounce((async e=>await d(e)),500)},onItemClick:p,value:u.value},null,8,["data-source","opened","search-editor-options","value"])])),_:1},8,["value","opened","data-source"])],64)}}};const $=Y;var x=$,H=t(63143),B=t.n(H),W=t(39660),K=t.n(W),j=t(54367);const F={style:{"overflow-y":"visible"}};var q={__name:"Multifield",props:["row"],emits:["changePending"],setup(e,{emit:a}){const t=e,l=(0,i.iH)([]),r=(0,i.iH)(!0),s=(0,i.iH)([]),o=(0,i.iH)([]),c={WORK:"Рабочий",MOBILE:"Мобильный",FAX:"Факс",HOME:"Домашний",PAGER:"Пейджер",MAILING:"Для рассылок",OTHER:"Другой",OPENLINE:"Онлайн-чат",IMOL:"Открытая линия"},u=Object.fromEntries(Object.entries(c).map((e=>e.reverse())));(0,n.bv)((()=>{l.value=_.cloneDeep(t.row.TRUEVALUE)||[],o.value=_.cloneDeep(t.row.TRUEVALUE)||[]}));const E=()=>{const e=[];let t;o.value.forEach((a=>{l.value.filter((e=>e.VALUE===a.VALUE&&e.VALUE_TYPE===a.VALUE_TYPE&&a.ID)).length||e.push({ID:a.ID,VALUE:""})})),l.value.forEach((a=>{e.push({...a})})),t=e.filter((e=>e.VALUE)).length?e.filter((e=>e.VALUE)).map((e=>({ID:c[e.VALUE_TYPE],NAME:e.VALUE}))).map((e=>`${e.ID}: ${e.NAME}, `)).reduce(((e,a)=>e.concat(a))):"",a("changePending",_.cloneDeep(e),t)},d=(e,a)=>{const t=a;t?l.value.find((e=>e.ID===t)).VALUE=e.event.currentTarget.value:l.value[l.value.length-1].VALUE=e.event.currentTarget.value,l.value[l.value.length-1]?.VALUE&&l.value[l.value.length-1]?.VALUE_TYPE&&(r.value=!0),E()},v=(e,a)=>{const t=u[e.selectedItem],n=a;n?l.value.find((e=>e.ID===n)).VALUE_TYPE=t:l.value[l.value.length-1].VALUE_TYPE=t,l.value[l.value.length-1].VALUE&&l.value[l.value.length-1].VALUE_TYPE&&(r.value=!0),E()},p=(e,a)=>{const t=a;let n=l.value.find((e=>e.ID===t));const i=l.value.indexOf(n);l.value.splice(i,1),l.value.length&&(l.value[l.value.length-1]||l.value[l.value.length-1].VALUE&&l.value[l.value.length-1].VALUE_TYPE)?r.value=!0:(r.value=!0,E(),n&&n.TYPE_ID&&s.value.push({ID:n.ID,VALUE_TYPE:n.VALUE_TYPE,VALUE:n.VALUE,TYPE_ID:n.TYPE_ID}))},I=(e,a)=>{if(l.value.length&&(l.value[l.value.length-1]||l.value[l.value.length-1].VALUE&&l.value[l.value.length-1].VALUE_TYPE))return l.value.push({VALUE:"",TYPE_ID:"",VALUE_TYPE:""}),void(r.value=!1);l.value.push({VALUE:"",TYPE_ID:"",VALUE_TYPE:""}),r.value=!1};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)("div",F,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.value,(e=>((0,n.wg)(),(0,n.iD)("div",{style:{padding:"1rem",display:"flex","flex-direction":"row","align-items":"center"},key:e.ID},[e.VALUE||!e.ID?((0,n.wg)(),(0,n.j4)((0,i.SU)(K()),{key:0,onInput:a=>d(a,e.ID),value:e.VALUE,style:{width:"10rem"},maskInvalidMessage:"Неправильный формат ввода"},null,8,["onInput","value"])):(0,n.kq)("",!0),e.VALUE||!e.ID?((0,n.wg)(),(0,n.j4)((0,i.SU)(B()),{key:1,onSelectionChanged:a=>v(a,e.ID),"data-source":Object.values(c),value:c[e.VALUE_TYPE],style:{width:"8rem"}},null,8,["onSelectionChanged","data-source","value"])):(0,n.kq)("",!0),e.VALUE||!e.ID?((0,n.wg)(),(0,n.j4)(t,{key:2,style:{border:"0ch","pointer-events":"all",cursor:"pointer"},onClick:a=>p(a,e.ID)},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(j.Z),{style:{"pointer-events":"none"}})])),_:2},1032,["onClick"])):(0,n.kq)("",!0)])))),128)),(0,n.Wm)(t,{onClick:I,disabled:!r.value},{default:(0,n.w5)((()=>[(0,n.Uk)("Добавить поле")])),_:1},8,["disabled"])])}}};const Z=q;var z=Z;const G={style:{"overflow-y":"visible"}},Q=(0,n._)("br",null,null,-1),X={key:0,style:{display:"grid","grid-template-rows":"2rem","grid-template-columns":"repeat(2, 5rem, 10rem)","padding-bottom":"1rem"}},J=(0,n._)("h3",null,"Контакты",-1),ee={key:1,style:{display:"grid","grid-template-rows":"2rem","grid-template-columns":"repeat(2, 5rem, 10rem)","padding-bottom":"1rem"}},ae=(0,n._)("h3",null,"Компании",-1),te={key:2,style:{display:"grid","grid-template-rows":"2rem","grid-template-columns":"repeat(2, 5rem, 10rem)","padding-bottom":"1rem"}},le=(0,n._)("h3",null,"Лиды",-1),ne={key:3,style:{display:"grid","grid-template-rows":"2rem","grid-template-columns":"repeat(2, 5rem, 10rem)","padding-bottom":"1rem"}},ie=(0,n._)("h3",null,"Счета",-1),re={key:4,style:{display:"grid","grid-template-rows":"2rem","grid-template-columns":"repeat(2, 5rem, 10rem)","padding-bottom":"1rem"}},se=(0,n._)("h3",null,"Сделки",-1);var oe={__name:"Crm",props:["row"],emits:"changePending",setup(e,{emit:a}){const t=e,l=(0,i.iH)({}),r=(0,i.iH)({}),s=(0,i.iH)([]),o=(0,i.iH)({deal:null,lead:null,contact:null,company:null,invoice:null}),c=(0,i.iH)({deal:!1,lead:!1,contact:!1,company:!1,invoice:!1});(0,n.wF)((async()=>{r.value={deal:[],lead:[],contact:[],company:[],invoice:[]};const e={SI:"invoice",CO:"company",C_:"contact",D_:"deal",L_:"lead"},a=(e,a)=>{switch(e){case"invoice":return a.substring(3);case"company":return a.substring(3);case"contact":return a.substring(2);case"deal":return a.substring(2);case"lead":return a.substring(2)}};if(s.value=N().cloneDeep(t.row.CRMENTITY),!t.row.TRUEVALUE)return;const n=t.row.TRUEVALUE[0],i=e[n.substring(0,2)],c=a(i,n);console.log(r.value),l.value[i]="invoice"===i?await(await(0,E.OC)("crm.item.list",{entityTypeId:7})).data().items.map((e=>({ID:e.id,NAME:v(i,e)}))):await(await(0,E.OC)(`crm.${i}.list`)).data().map((e=>({ID:e.ID,NAME:v(i,e)}))),r.value[i]={ID:c},o.value[i]=c}));const u=async e=>{c.value[e]=!0,console.log(e),document.getElementsByClassName("dx-texteditor-input")[0].addEventListener("input",(a=>p(a,e))),l.value[e]="invoice"!==e?await(await(0,E.OC)(`crm.${e}.list`)).data().map((a=>({ID:a.ID,NAME:v(e,a)}))):await(await(0,E.OC)("crm.item.list",{entityTypeId:7})).data().items.map((a=>({ID:a.id,NAME:v(e,a)})))},d=(e,t)=>{c.value[t]=!1,console.log(l.value[t],e);const n=e.itemData.ID;r.value[t]=l.value[t].find((e=>e.ID==n)),Object.keys(r.value).forEach((e=>{e!=t&&(r.value[e]=null)})),e.itemData.selected?r.value[t]={}:r.value[t]=e.itemData,console.log(r.value);const i=Object.keys(r.value).map((e=>{switch(e){case"deal":return r.value[e]?.ID?`D_${r.value[e].ID}`:"";case"lead":return r.value[e]?.ID?`L_${r.value[e].ID}`:"";case"contact":return r.value[e]?.ID?`C_${r.value[e].ID}`:"";case"company":return r.value[e]?.ID?`CO_${r.value[e].ID}`:"";case"invoice":return r.value[e]?.ID?`SI_${r.value[e].ID}`:""}})).filter((e=>e)),s=Object.keys(r.value).map((e=>{switch(e){case"deal":if(r.value[e])return`Сделка: ${r.value[e].NAME}`;case"lead":if(r.value[e])return`Лид: ${r.value[e].NAME}`;case"contact":if(r.value[e])return`Контакт: ${r.value[e].NAME}`;case"company":if(r.value[e])return`Компания: ${r.value[e].NAME}`;case"invoice":if(r.value[e])return`Счет: ${r.value[e].NAME}`}})).filter((e=>e)).join(", ");a("changePending",i,s),c.value[t]=!1},v=(e,a)=>{switch(e){case"lead":return`${a.TITLE} [${a.ID}]`;case"deal":return`${a.TITLE} [${a.ID}]`;case"contact":return`${a.NAME} [${a.ID}]`;case"company":return`${a.TITLE} [${a.ID}]`;case"invoice":return`${a.searchContent} [${a.id}]`}},p=async(e,a)=>{if("invoice"===a){const a={entityTypeId:7,filter:{"%searchContent":e.event.currentTarget.value}};await(await(0,E.OC)("crm.item.list",a)).data().items.map((e=>({ID:e.id,NAME:`${e.searchContent} [${e.id}]`})))}else await(await(0,E.OC)(`crm.${a}.list`,{FILTER:{"%TITLE":`${e.event.currentTarget.value}`}})).data().map((e=>({ID:e.ID,NAME:v(a,e)}))).forEach((e=>{l.value[a].filter((a=>a.ID==e.ID)).length||(l.value[a]=[...l.value[a],e])}))},I=(e,a)=>{Object.keys(o.value).forEach((e=>{e!=a&&(o.value[e]=null)})),o.value[a]=e.component.getSelectedNodeKeys(),console.log(o.value),c.value[a]=!1},A=()=>{r.value={},o.value={},a("changePending","","")};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)("div",G,[(0,n.Wm)(t,{onClick:A},{default:(0,n.w5)((()=>[(0,n.Uk)("Очистить значение поля")])),_:1}),Q,s.value.includes("CONTACT")?((0,n.wg)(),(0,n.iD)("div",X,[J,(0,n.Wm)((0,i.SU)(C()),{value:o.value["contact"],"data-source":l.value["contact"],"value-expr":"ID","display-expr":"NAME",onOpened:a[3]||(a[3]=e=>u("contact")),opened:c.value["contact"]},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{onOpened:a[0]||(a[0]=e=>u("contact")),ref:"drop",value:r.value["contact"]?.ID,"data-structure":"plain","selection-mode":"single",onItemClick:a[1]||(a[1]=e=>d(e,"contact")),"search-enabled":!0,onItemSelectionChanged:a[2]||(a[2]=e=>I(e,"contact")),"select-by-click":!0,"key-expr":"ID","display-expr":"NAME","search-expr":"NAME","data-source":l.value["contact"],"search-editor-options":{onInput:(0,i.SU)(N()).debounce((async e=>await p(e,"contact")),500)}},null,8,["value","data-source","search-editor-options"])])),_:1},8,["value","data-source","opened"])])):(0,n.kq)("",!0),s.value.includes("COMPANY")?((0,n.wg)(),(0,n.iD)("div",ee,[ae,(0,n.Wm)((0,i.SU)(C()),{"data-source":l.value["company"],"value-expr":"ID","display-expr":"NAME",onOpened:a[7]||(a[7]=e=>u("company")),opened:c.value["company"],value:o.value["company"]},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{onOpened:a[4]||(a[4]=e=>u("company")),ref:"drop",value:o.value["company"]?.ID,"data-structure":"plain","selection-mode":"single",onItemSelectionChanged:a[5]||(a[5]=e=>I(e,"company")),onItemClick:a[6]||(a[6]=e=>d(e,"company")),"search-enabled":!0,"select-by-click":!0,"key-expr":"ID","display-expr":"NAME","search-expr":"NAME","data-source":l.value["company"],"search-editor-options":{onInput:(0,i.SU)(N()).debounce((async e=>await p(e,"company")),500)}},null,8,["value","data-source","search-editor-options"])])),_:1},8,["data-source","opened","value"])])):(0,n.kq)("",!0),s.value.includes("LEAD")?((0,n.wg)(),(0,n.iD)("div",te,[le,(0,n.Wm)((0,i.SU)(C()),{value:o.value["lead"],"data-source":l.value["lead"],"value-expr":"ID","display-expr":"NAME",onOpened:a[11]||(a[11]=e=>u("lead")),opened:c.value["lead"]},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{onOpened:a[8]||(a[8]=e=>u("lead")),ref:"drop",value:r.value["lead"]?.ID,"data-structure":"plain",onItemSelectionChanged:a[9]||(a[9]=e=>I(e,"lead")),"selection-mode":"single",onItemClick:a[10]||(a[10]=e=>d(e,"lead")),"search-enabled":!0,"select-by-click":!0,"key-expr":"ID","display-expr":"NAME","search-expr":"NAME","data-source":l.value["lead"],"search-editor-options":{onInput:(0,i.SU)(N()).debounce((async e=>await p(e,"lead")),500)}},null,8,["value","data-source","search-editor-options"])])),_:1},8,["value","data-source","opened"])])):(0,n.kq)("",!0),s.value.includes("SMART_INVOICE")?((0,n.wg)(),(0,n.iD)("div",ne,[ie,(0,n.Wm)((0,i.SU)(C()),{value:o.value["invoice"],"data-source":l.value["invoice"],"value-expr":"ID","display-expr":"NAME",onOpened:a[15]||(a[15]=e=>u("invoice")),opened:c.value["invoice"]},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{onOpened:a[12]||(a[12]=e=>u("invoice")),ref:"drop",value:r.value["invoice"]?.ID,onItemSelectionChanged:a[13]||(a[13]=e=>I(e,"invoice")),"data-structure":"plain","selection-mode":"single",onItemClick:a[14]||(a[14]=e=>d(e,"invoice")),"search-enabled":!0,"select-by-click":!0,"key-expr":"ID","display-expr":"NAME","search-expr":"NAME","data-source":l.value["invoice"],"search-editor-options":{onInput:(0,i.SU)(N()).debounce((async e=>await p(e,"invoice")),500)}},null,8,["value","data-source","search-editor-options"])])),_:1},8,["value","data-source","opened"])])):(0,n.kq)("",!0),s.value.includes("DEAL")?((0,n.wg)(),(0,n.iD)("div",re,[se,(0,n.Wm)((0,i.SU)(C()),{"data-source":l.value["deal"],"value-expr":"ID","display-expr":"NAME",onOpened:a[19]||(a[19]=e=>u("deal")),value:o.value["deal"],opened:c.value["deal"]},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(b()),{onOpened:a[16]||(a[16]=e=>u("deal")),ref:"drop",value:r.value["deal"]?.ID,"data-structure":"plain","selection-mode":"single",onItemSelectionChanged:a[17]||(a[17]=e=>I(e,"deal")),onItemClick:a[18]||(a[18]=e=>d(e,"deal")),"search-enabled":!0,"select-by-click":!0,"key-expr":"ID","display-expr":"NAME","search-expr":"NAME","data-source":l.value["deal"],"search-editor-options":{onInput:(0,i.SU)(N()).debounce((async e=>await p(e,"deal")),500)}},null,8,["value","data-source","search-editor-options"])])),_:1},8,["data-source","value","opened"])])):(0,n.kq)("",!0)])}}};const ce=oe;var ue=ce;const Ee=(0,n._)("br",null,null,-1);var de={__name:"CrmMulti",props:["row","valueRef"],emits:["changePending"],setup(e,{emit:a}){const t=e,l=(0,i.iH)({}),r=(0,i.iH)({}),o=(0,i.iH)([]),c=(0,i.iH)({}),u=(0,i.iH)({lead:[],deal:[],contact:[],company:[],invoice:[]}),d=e=>{switch(console.log(e),e){case"LEAD":return"Лиды";case"DEAL":return"Сделки";case"COMPANY":return"Компании";case"CONTACT":return"Контакты";case"SMART_INVOICE":case"INVOICE":return"Счета"}},v=(e,a)=>{switch(e){case"lead":return`${a.TITLE} [${a.ID}]`;case"deal":return`${a.TITLE} [${a.ID}]`;case"contact":return`${a.NAME} [${a.ID}]`;case"company":return`${a.TITLE} [${a.ID}]`;case"invoice":return`${a.searchContent} [${a.id}]`}};(0,n.wF)((()=>{o.value=N().cloneDeep(t.row.CRMENTITY),c.value=N().cloneDeep(t.row),t.row.TRUEVALUE.forEach((async e=>{switch(console.log(e),e.substring(0,2)){case"L_":{const a=e.substring(2),t=await(await(0,E.OC)("crm.lead.get",{ID:a})).data()["TITLE"];u.value.lead.push({ID:a,NAME:`${t} [${a}]`});break}case"D_":{const a=e.substring(2),t=await(await(0,E.OC)("crm.deal.get",{ID:a})).data()["TITLE"];u.value.deal.push({ID:a,NAME:`${t} [${a}]`});break}case"C_":{const a=e.substring(2),t=await(await(0,E.OC)("crm.contact.get",{ID:a})).data()["TITLE"];u.value.contact.push({ID:a,NAME:`${t} [${a}]`});break}case"SI":{const a=e.substring(3),t=await(await(0,E.OC)("crm.item.get",{id:a,entityTypeId:7})).data().item.searchContent;u.value.invoice.push({ID:a,NAME:`${t} [${a}]`});break}case"CO":{const a=e.substring(3),t=await(await(0,E.OC)("crm.company.get",{ID:a})).data()["TITLE"];u.value.company.push({ID:a,NAME:`${t} [${a}]`});break}}})),console.log(u.value)}));const p=async(e,a)=>{let t=a;"smart_invoice"===t&&(t="invoice");const l="invoice"!==t?await(await(0,E.OC)(`crm.${t}.list`)).data():await(await(0,E.OC)("crm.item.list",{entityTypeId:7})).data().items;r.value[t]=l.map((e=>({ID:e.ID||e.id,NAME:v(t,e)}))).map((e=>u.value[t].filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e}))},I=async(e,a)=>{let t=a;"smart_invoice"===t&&(t="invoice"),console.log(t),console.log(e);const l={FILTER:{"%TITLE":e.event.currentTarget.value}};switch(t){case"deal":case"company":case"contact":case"lead":await(await(0,E.OC)(`crm.${t}.list`,l)).data().map((e=>({ID:e.ID,NAME:`${e.TITLE} [${e.ID}]`}))).map((e=>c.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})).forEach((e=>{console.log(e),r.value[t].filter((a=>a.ID==e.ID)).length||(r.value[t]=[...r.value[t],e])}));break;case"invoice":{const a={entityTypeId:7,filter:{"%searchContent":e.event.currentTarget.value}};await(await(0,E.OC)("crm.item.list",a)).data().items.map((e=>({ID:e.id,NAME:`${e.searchContent} [${e.id}]`}))).map((e=>c.value.TRUEVALUE.filter((a=>a.ID==e.ID)).length?{...e,CHECK:!0}:{...e})).forEach((e=>{console.log(e),r.value[t].filter((a=>a.ID==e.ID)).length||(r.value[t]=[...r.value[t],e])}));break}}console.log(r.value[t])},A=(e,t)=>{let l=t;"smart_invoice"===t&&(l="invoice");const n=e.itemData;if(n.CHECK)u.value[l].push(n);else{const e=u.value[l].find((e=>e.ID==n.ID)),a=u.value[l].indexOf(e);u.value[l].splice(a,1)}let i;i=Object.keys(u.value).map((e=>(console.log(e),u.value[e].map((a=>`${d(e.toUpperCase())}: ${a.NAME}`)).join(", ")))).filter((e=>e)).join(", ");let r=Object.keys(u.value).filter((e=>u.value[e])).map((e=>u.value[e].map((a=>{switch(console.log(a),e){case"lead":return`L_${a.ID}`;case"deal":return`D_${a.ID}`;case"contact":return`C_${a.ID}`;case"company":return`CO_${a.ID}`;case"invoice":return`SI_${a.ID}`}})))).filter((e=>e.length)).flat();console.log(r),a("changePending",N().cloneDeep(r),i)},m=()=>{a("changePending","","")};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(t,{onClick:m},{default:(0,n.w5)((()=>[(0,n.Uk)("Очистить значение поля")])),_:1}),Ee,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.value,(e=>((0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("h3",null,(0,s.zw)(d(e)),1),(0,n.Wm)((0,i.SU)(C()),{"data-source":r.value[e.toLowerCase()],"value-expr":"ID","display-expr":"NAME",onOpened:a=>p(a,e.toLowerCase())},{default:(0,n.w5)((()=>[((0,n.wg)(),(0,n.j4)((0,i.SU)(b()),{onOpened:a=>p(a,e.toLowerCase()),"selected-expr":"CHECK",key:e,ref_for:!0,ref:"drop",value:l.value,"data-structure":"plain","selection-mode":"multiple","show-check-boxes-mode":"normal",onItemSelectionChanged:a=>A(a,e.toLowerCase()),opened:!0,"search-enabled":!0,"key-expr":"ID","display-expr":"NAME","search-expr":"NAME","data-source":r.value["SMART_INVOICE"===e?"invoice":e.toLowerCase()],"search-editor-options":{onInput:async a=>await I(a,e.toLowerCase())}},null,8,["onOpened","value","onItemSelectionChanged","data-source","search-editor-options"]))])),_:2},1032,["data-source","onOpened"])])))),256))],64)}}};const ve=de;var pe=ve,Ie=t(46328),Ae=t(49884);const me=(0,n._)("br",null,null,-1);var De={__name:"DatePicker",props:["row"],emits:["changePending"],setup(e,{emit:a}){const t=e,l=(0,i.iH)(new Date),r=(0,i.iH)("");(0,n.wF)((()=>{r.value=_.cloneDeep(t.row.EDITOR),l.value=_.cloneDeep(t.row.TRUEVALUE),console.log(r.value)}));const s=e=>{const t=e.value;let l;l="datetime"===r.value?new Date(t).toLocaleString("RU"):new Date(t).toLocaleDateString("RU"),a("changePending",t,l)},o=()=>{a("changePending","","")};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(t,{onClick:o},{default:(0,n.w5)((()=>[(0,n.Uk)("Очистить значение поля")])),_:1}),me,(0,n.Wm)((0,i.SU)(Ae.eH),{onValueChanged:s,type:r.value,value:l.value},null,8,["type","value"])],64)}}};const Le=De;var ge=Le,Ue=t(83465),Te=t.n(Ue);const ye={style:{display:"flex","flex-direction":"row","align-items":"center"}},fe=(0,n._)("br",null,null,-1),he={style:{display:"flex","flex-direction":"row"}};var we={__name:"TextBoxArr",props:["row"],emits:["changePending"],setup(e,{emit:a}){const t=e,l=(0,i.iH)([""]);(0,n.wF)((()=>{l.value=Te()(t.row.TRUEVALUE)}));const r=(e,t)=>{console.log(e),l.value[t]=e.event.currentTarget?.value,a("changePending",l.value,l.value.join(", "))},s=()=>{l.value.push("")},o=e=>{l.value.splice(e,1),a("changePending",l.value,l.value.join(", "))};return(e,a)=>{const t=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.value,((e,a)=>((0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("div",ye,[(0,n.Wm)((0,i.SU)(Ae.ki),{value:e,onInput:e=>r(e,a)},null,8,["value","onInput"]),(0,n.Wm)((0,i.SU)(j.Z),{onClick:e=>o(a)},null,8,["onClick"])]),fe])))),256)),(0,n._)("div",he,[(0,n.Wm)(t,{style:{"margin-right":"0.5rem"},type:"primary",onClick:s},{default:(0,n.w5)((()=>[(0,n.Uk)(" Добавить поле ")])),_:1})])],64)}}};const Ce=we;var _e=Ce,Oe={__name:"TextBox",props:["row"],emits:["changePending"],setup(e,{emit:a}){const t=(0,i.iH)(""),l=e=>{t.value=e.event.currentTarget?.value,a("changePending",t.value,t.value)};return(e,a)=>((0,n.wg)(),(0,n.j4)((0,i.SU)(Ae.ki),{onInput:a[0]||(a[0]=e=>l(e))}))}};const be=Oe;var Ve=be;const Ne=e=>((0,n.dD)("data-v-597e8e5b"),e=e(),(0,n.Cn)(),e),Me={id:"app-container"},Re=Ne((()=>(0,n._)("p",null,"После сохранения в форме не забудьте сохранить изменения на сервер, нажав на кнопку",-1))),Se=Ne((()=>(0,n._)("br",null,null,-1))),ke={onmouseover:"this.style.wordWrap = 'break-word' ;this.style.overflow = 'wrap';this.style.whiteSpace = 'normal'",onmouseout:"this.style.wordWrap = '';this.style.overflow = '';this.style.whiteSpace = '';"},Pe={style:{display:"block"}},Ye=Ne((()=>(0,n._)("h2",null,"Тип поля не поддерживается",-1)));var $e={__name:"TableDataGrid",setup(e){const a=(0,i.iH)([]),t=(0,i.iH)({}),l=(0,i.iH)([]),o=(0,i.iH)(null),c=(0,i.iH)(!1),u=(0,i.iH)(!0),d=(0,i.iH)(""),v=(0,i.iH)("Сохранить"),p=(0,i.iH)([]),I=(0,i.iH)(""),A=(0,i.iH)(""),m=(0,i.iH)({}),D=(0,i.iH)(!1),L=(0,i.iH)(!1);(0,n.bv)((async()=>{const e=await T().next();a.value=e.value[0],t.value=e.value[1],u.value=!1,l.value=h,await y(a,t).next()}));const f=e=>{if(e.row){switch(o.value.instance.getVisibleRows().forEach((e=>{e.cells[6]&&(e.cells[6].cellElement.style.visibility="hidden")})),e.row.data.EDITOR){case"textBox":d.value="textBox";break;case"textArray":d.value="textArr";break;case"crm":d.value="crm";break;case"date":case"datetime":d.value="datetime";break;case"checkBoxes":d.value="enum",D.value=!0;break;case"selectBox":d.value="select";break;case"multiedit":d.value="multifield";break;case"crmMulti":d.value="crmMulti";break;default:d.value="notSupported"}L.value=!0,A.value=e.row.data.NAME,m.value=e.row.data}},w=e=>{e.changes=[{data:{TRUEVALUE:p.value,DISPLAYVALUE:I.value},key:m.value.NAME,type:"update"}],d.value="",L.value=!1,o.value.instance.getVisibleRows().forEach((e=>{e.cells[6]&&(e.cells[6].cellElement.style.visibility="visible")}))},C=()=>{d.value="",p.value=[],console.log(p.value,"cancel"),L.value=!1,o.value.instance.getVisibleRows().forEach((e=>{e.cells[6]&&(e.cells[6].cellElement.style.visibility="visible")}))},_=(e,a)=>{p.value=N().cloneDeep(e),I.value=a,console.log(p.value,I.value,"pend")},O=async()=>{r.Z.open({message:"Загрузка может занять некоторое время"}),c.value=!0;const e=[];let t={};const l=[];a.value.forEach((a=>{const t=a.NAME;e.push(t)}));const n=await E.k$.info();let i,s,o=n.placement.split("_")[1].toLowerCase();"smart"===o?(o="item",i=31,s=e.map((e=>({[e]:{method:"crm.item.list",params:{filter:{[`!${e}`]:""},entityTypeId:i}}})))):"dynamic"===o?(o="item",i=n.placement.split("_")[2],s=e.map((e=>({[e]:{method:"crm.item.list",params:{filter:{[`!${e}`]:""},entityTypeId:i}}})))):s=e.map((e=>({[e]:{method:`crm.${o}.list`,params:{filter:{[`!${e}`]:""}}}})));try{while(s.length){const e=s.splice(0,50);t={};for(let l=0;l<e.length;l++)t[Object.keys(e[l])[0]]=Object.values(e[l])[0];console.log(t);const a=await(0,E.iy)(t);l.push(a)}const e=l.flat();console.log(e),e.forEach((e=>{Object.keys(e).forEach((t=>{a.value.find((e=>e.NAME===t)).COUNTUSES=e[t].answer.total,console.log(e[t].answer.total)}))})),c.value=!1}catch(u){r.Z.open({message:"Возникли ошибки при подсчете"}),c.value=!1}},b=async()=>{v.value="Сохраняем...";let e=await E.k$.info(),t=e.placement.split("_")[1].toLowerCase(),l=e.options.ID,n={};a.value.forEach((e=>{e.TRUEVALUE?Array.isArray(e.TRUEVALUE)?(n[e.NAME]=e.TRUEVALUE.map((e=>e.ID)),("crm_multifield"===e.TYPE||"crm"===e.TYPE&&"crmMulti"===e.EDITOR||"textArray"===e.EDITOR)&&(n[e.NAME]=e.TRUEVALUE,console.log(e.TRUEVALUE)),"crm"===e.TYPE&&"crm"===e.EDITOR&&(n[e.NAME]=e.TRUEVALUE[0])):"date"!==e.EDITOR&&"datetime"!==e.EDITOR&&"string"!==e.TYPE&&"integer"!==e.TYPE&&"double"!==e.TYPE?n[e.NAME]=e.TRUEVALUE.ID:n[e.NAME]=e.TRUEVALUE:n[e.NAME]=e.DISPLAYVALUE})),await(0,E.OC)(`crm.${t}.update`,{id:l,fields:n,params:{REGISTER_SONET_EVENT:"Y"}}).then((e=>{e.error()?(console.error(e.error()),v.value="Изменения не были сохранены",setTimeout((()=>{v.value="Сохранить"}),2e3)):(v.value="Изменения сохранены",setTimeout((()=>{v.value="Сохранить"}),2e3))}))},V=e=>{if("edit"===e.column?.command&&e.row){if(e.row.data.PERMISSIONS.includes("Только для чтения"))return e.cellElement.style.opacity=0,void(e.cellElement.style.visibility="hidden");if(e.row.data.ALLOW)return e.cellElement.style.opacity=100,void(e.cellElement.style.visibility="visible");if("nan"===e.row.data.EDITOR)return e.cellElement.style.visibility="hidden",void(e.cellElement.style.opacity=0);if(!e.row.data.DISPLAYVALUE)return e.cellElement.style.visibility="visible",void(e.cellElement.style.opacity=100)}};return(e,t)=>{const r=(0,n.up)("a-button"),E=(0,n.up)("a-spin");return(0,n.wg)(),(0,n.iD)("div",Me,[Re,(0,n.Wm)(E,{wrapperClassName:"spinner",spinning:u.value,style:{display:"flex","justify-content":"center","align-content":"center"}},{default:(0,n.w5)((()=>[Se,u.value?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(r,{key:0,loading:c.value,onClick:O},{default:(0,n.w5)((()=>[(0,n.Uk)(" Посчитать количество использований полей ")])),_:1},8,["loading"])),(0,n.Wm)(r,{type:"primary",id:"btn_save2",onClick:b,style:{display:"block",position:"absolute",top:"0%"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(Ie.Z),{style:{"pointer-events":"none"}}),(0,n.Uk)(" "+(0,s.zw)(v.value),1)])),_:1}),(0,n.Wm)((0,i.SU)(g.DxDataGrid),{onCellPrepared:V,"focused-row-enabled":"",id:"dataGrid","data-source":a.value,"key-expr":"NAME","allow-editing":!0,"allow-column-reordering":!0,ref_key:"dataGridRefKey",ref:o,columns:l.value,onEditorPreparing:t[0]||(t[0]=e=>f(e)),onSaving:w,onEditCanceled:t[1]||(t[1]=e=>C(e))},{"grid-cell":(0,n.w5)((({data:e})=>[(0,n._)("div",ke,(0,s.zw)(e.value?.NAME||e.value),1)])),label:(0,n.w5)((({})=>[(0,n._)("label",Pe,(0,s.zw)(A.value),1)])),textArr:(0,n.w5)((({})=>[(0,n.Wm)(_e,{onChangePending:_,row:m.value},null,8,["row"])])),textBox:(0,n.w5)((({})=>[(0,n.Wm)(Ve,{onChangePending:_,row:m.value},null,8,["row"])])),crm:(0,n.w5)((({})=>[(0,n.Wm)(ue,{onChangePending:_,row:m.value},null,8,["row"])])),enum:(0,n.w5)((({})=>[(0,n.Wm)(k,{onChangePending:_,row:m.value},null,8,["row"])])),select:(0,n.w5)((({})=>[(0,n.Wm)(x,{onChangePending:_,row:m.value},null,8,["row"])])),multifield:(0,n.w5)((({})=>[(0,n.Wm)(z,{onChangePending:_,row:m.value},null,8,["row"])])),datetime:(0,n.w5)((({})=>[(0,n.Wm)(ge,{onChangePending:_,row:m.value},null,8,["row"])])),crmMulti:(0,n.w5)((({})=>[(0,n.Wm)(pe,{onChangePending:_,row:m.value},null,8,["row"])])),notSupported:(0,n.w5)((({})=>[Ye])),default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(g.DxHeaderFilter),{visible:!0}),(0,n.Wm)((0,i.SU)(g.DxColumnChooser),{enabled:!0}),(0,n.Wm)((0,i.SU)(g.DxExport),{enabled:!0}),(0,n.Wm)((0,i.SU)(g.DxGroupPanel),{visible:!0}),(0,n.Wm)((0,i.SU)(g.DxSearchPanel),{visible:!0}),(0,n.Wm)((0,i.SU)(g.DxFilterRow),{visible:!0}),(0,n.Wm)((0,i.SU)(g.DxEditing),{mode:"form","use-icons":!0,height:500,"allow-updating":!0},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(g.DxForm),{"col-span":2,"editor-options":{height:300},"scrolling-enabled":"",style:{display:"flex","flex-direction":"column"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(U.DxItem),{"data-field":"DISPLAYVALUE",template:d.value||null},null,8,["template"]),(0,n.Wm)((0,i.SU)(U.DxItem),{template:"label"})])),_:1})])),_:1})])),_:1},8,["data-source","columns"]),u.value?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(r,{key:1,type:"primary",id:"btn_save1",onClick:b,style:{display:"block",position:"absolute",bottom:"0%"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(Ie.Z),{style:{"pointer-events":"none"}}),(0,n.Uk)(" "+(0,s.zw)(v.value),1)])),_:1}))])),_:1},8,["spinning"])])}}};const xe=(0,m.Z)($e,[["__scopeId","data-v-597e8e5b"]]);var He=xe,Be={__name:"Tablescreen",setup(e){return(e,a)=>((0,n.wg)(),(0,n.j4)(He))}};const We=Be;var Ke=We,je={__name:"App",setup(e){const a=()=>{try{const e=window.name.split("|"),a=e[0].replace(/:(80|443)$/,""),t=!!parseInt(e[1]),l=e[2];parent.postMessage("resizeWindow:"+JSON.stringify({width:"100%",height:Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight)})+"::"+l,"http"+(t?"s":"")+"://"+a)}catch(e){console.error("resizeWindow",e)}},t=(0,i.iH)({options:[],placement:""}),l=(0,n.Fl)((()=>!!window.name));return(0,n.wF)((async()=>{l.value&&setInterval(a,500),t.value=await E.k$.info(),"DEFAULT"===t.value.placement?t.value="DEF":t.value="NOTDEF"})),(e,a)=>((0,n.wg)(),(0,n.iD)(n.HY,null,["DEF"===t.value?((0,n.wg)(),(0,n.j4)(L,{key:0})):(0,n.kq)("",!0),"NOTDEF"===t.value?((0,n.wg)(),(0,n.j4)(Ke,{key:1})):(0,n.kq)("",!0)],64))}};const Fe=(0,m.Z)(je,[["__scopeId","data-v-cf949210"]]);var qe=Fe,Ze=t(44594),ze=(t(62467),t(22233)),Ge=t(24624),Qe=t(33907),Xe=(0,Qe.MT)({state:{},getters:{},mutations:{},actions:{},modules:{}});(0,Ge.EV)(ze),(0,Ge.SP)("ru"),(0,l.ri)(qe).use(Ze.ZP).use(Xe).mount("#app")}},a={};function t(l){var n=a[l];if(void 0!==n)return n.exports;var i=a[l]={id:l,loaded:!1,exports:{}};return e[l].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}t.m=e,function(){var e=[];t.O=function(a,l,n,i){if(!l){var r=1/0;for(u=0;u<e.length;u++){l=e[u][0],n=e[u][1],i=e[u][2];for(var s=!0,o=0;o<l.length;o++)(!1&i||r>=i)&&Object.keys(t.O).every((function(e){return t.O[e](l[o])}))?l.splice(o--,1):(s=!1,i<r&&(r=i));if(s){e.splice(u--,1);var c=n();void 0!==c&&(a=c)}}return a}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[l,n,i]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};t.O.j=function(a){return 0===e[a]};var a=function(a,l){var n,i,r=l[0],s=l[1],o=l[2],c=0;if(r.some((function(a){return 0!==e[a]}))){for(n in s)t.o(s,n)&&(t.m[n]=s[n]);if(o)var u=o(t)}for(a&&a(l);c<r.length;c++)i=r[c],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(u)},l=self["webpackChunkapp_bps_tree_vuejs"]=self["webpackChunkapp_bps_tree_vuejs"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))}();var l=t.O(void 0,[998],(function(){return t(80623)}));l=t.O(l)})();
//# sourceMappingURL=app.7607f651.js.map